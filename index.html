
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="ORBOCceo-a1e6Je5tI-KUua73jJ2f5DjYTOVD4v8tz4" name="google-site-verification" />
<meta content="AjhRHQh3VrfjkedIiaUazWGgzaSBonwmXT_Kf5sPD0I" name="google-site-verification" />
<meta content="256433631B2CD469BD8EC0137A9943AA" name="msvalidate.01" />

    <title>Welcome to PyGears &#8212; PyGears - HW Design: A Functional Approach</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/default.js"></script>
    <script src="_static/wavedrom.js"></script>
    <link rel="canonical" href="https://docs.pygears.org/index.html" />
    <link rel="shortcut icon" href="_static/pygears.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Presentation for beginners" href="presentation_pygears.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="welcome-to-pygears">
<h1>Welcome to PyGears<a class="headerlink" href="#welcome-to-pygears" title="Permalink to this headline">¶</a></h1>
<img alt="_images/pygears_presentation_picture.png" class="align-center" src="_images/pygears_presentation_picture.png" />
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="presentation_pygears.html#presentation-pygears"><span class="std std-ref">Check our new presentation for beginners</span></a></p></td>
</tr>
</tbody>
</table>
<section id="hw-design-a-functional-approach">
<h2>HW Design: A Functional Approach<a class="headerlink" href="#hw-design-a-functional-approach" title="Permalink to this headline">¶</a></h2>
<p><strong>PyGears</strong> is a free framework that lets you design hardware using high-level Python constructs and compile it to synthesizable SystemVerilog or Verilog code. There is a built-in simulator that lets you use arbitrary Python code with its vast set of libraries to verify your hardware modules. <strong>PyGears</strong> makes connecting modules easy, and has built-in synchronization mechanisms that help you build correct parallel systems.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pygears</span> <span class="kn">import</span> <span class="n">gear</span><span class="p">,</span> <span class="n">Intf</span><span class="p">,</span> <span class="n">alternative</span>
<span class="kn">from</span> <span class="nn">pygears.lib</span> <span class="kn">import</span> <span class="n">decouple</span><span class="p">,</span> <span class="n">fmap</span><span class="p">,</span> <span class="n">union_collapse</span><span class="p">,</span> <span class="n">trunc</span>
<span class="kn">from</span> <span class="nn">pygears.typing</span> <span class="kn">import</span> <span class="n">Fixp</span><span class="p">,</span> <span class="n">ceil_pow2</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">pygears.lib</span> <span class="kn">import</span> <span class="n">flatten</span><span class="p">,</span> <span class="n">priority_mux</span><span class="p">,</span> <span class="n">replicate</span><span class="p">,</span> <span class="n">once</span>


<span class="nd">@gear</span>
<span class="k">def</span> <span class="nf">prefill</span><span class="p">(</span><span class="n">din</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">once</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> \
        <span class="o">|</span> <span class="n">replicate</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> \
        <span class="o">|</span> <span class="n">flatten</span>

    <span class="k">return</span> <span class="n">priority_mux</span><span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">din</span><span class="p">)</span> \
        <span class="o">|</span> <span class="n">union_collapse</span>


<span class="nd">@gear</span>
<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">din</span><span class="p">:</span> <span class="n">Fixp</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">feedback_gain</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
    <span class="n">sample_dly_len</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="n">delay</span><span class="p">)</span>
    <span class="n">fifo_depth</span> <span class="o">=</span> <span class="n">ceil_pow2</span><span class="p">(</span><span class="n">sample_dly_len</span><span class="p">)</span>
    <span class="n">feedback_gain_fixp</span> <span class="o">=</span> <span class="n">din</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">feedback_gain</span><span class="p">)</span>

    <span class="n">dout</span> <span class="o">=</span> <span class="n">Intf</span><span class="p">(</span><span class="n">din</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="n">feedback</span> <span class="o">=</span> <span class="n">dout</span> \
        <span class="o">|</span> <span class="n">decouple</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="n">fifo_depth</span><span class="p">)</span> \
        <span class="o">|</span> <span class="n">prefill</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">din</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">sample_dly_len</span><span class="p">)</span>

    <span class="n">feedback_attenuated</span> <span class="o">=</span> <span class="n">trunc</span><span class="p">(</span><span class="n">feedback</span> <span class="o">*</span> <span class="n">feedback_gain_fixp</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">din</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="n">dout</span> <span class="o">|=</span> <span class="n">trunc</span><span class="p">(</span><span class="n">din</span> <span class="o">+</span> <span class="n">feedback_attenuated</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">dout</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dout</span>
</pre></div>
</div>
<p>Python functions model hardware modules, where function arguments represent module inputs and parameters. Example <code class="docutils literal notranslate"><span class="pre">echo</span></code> module has a single input port called <code class="docutils literal notranslate"><span class="pre">samples</span></code> where data of arbitrary signed fixed-point type <code class="docutils literal notranslate"><span class="pre">Fixp</span></code> can be received. Other three parameters <code class="docutils literal notranslate"><span class="pre">feedback_gain</span></code>, <code class="docutils literal notranslate"><span class="pre">sample_rate</span></code> and <code class="docutils literal notranslate"><span class="pre">delay</span></code> are compile time parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@gear</span>
<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Fixp</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">feedback_gain</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Arbitrary Python code can be used in modules at compile time, for an example to transform input parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sample_dly_len</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="n">delay</span><span class="p">)</span>
<span class="n">fifo_depth</span> <span class="o">=</span> <span class="n">ceil_pow2</span><span class="p">(</span><span class="n">sample_dly_len</span><span class="p">)</span>
<span class="n">feedback_gain_fixp</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">feedback_gain</span><span class="p">)</span>
</pre></div>
</div>
<p>Rest of the <code class="docutils literal notranslate"><span class="pre">echo</span></code> function code describes the hardware module for applying echo audio effect to the input stream.</p>
<img alt="_images/echo.png" class="align-center" src="_images/echo.png" />
<p>Modules are instantiated using function calls: <code class="docutils literal notranslate"><span class="pre">decouple(dout,</span> <span class="pre">depth=fifo_depth)</span></code>, which return module output interfaces that can in turn be passed as arguments to other module functions in order to make a connection between the modules. For conveniance the pipe <code class="docutils literal notranslate"><span class="pre">&quot;|&quot;</span></code> operator can be used to pass output of one function as argument to the next one. This was used to connect the output of <code class="docutils literal notranslate"><span class="pre">decouple</span></code> to <code class="docutils literal notranslate"><span class="pre">prefill</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;\&quot;</span></code> is used just to split the line visually):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feedback</span> <span class="o">=</span> <span class="n">decouple</span><span class="p">(</span><span class="n">dout</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">fifo_depth</span><span class="p">)</span> \
    <span class="o">|</span> <span class="n">prefill</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">samples</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">sample_dly_len</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, the <code class="docutils literal notranslate"><span class="pre">echo</span></code> function returns its output interfaces which is then used to establish the connection with the next module that received the <code class="docutils literal notranslate"><span class="pre">echo</span></code> output stream:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@gear</span>
<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">dout</span>
</pre></div>
</div>
<p>Built-in simulator makes it easy to test and verify the modules while drawing power from the Python vast ecosystem of libraries. For an example, use Python built-in <a class="reference external" href="https://docs.python.org/3.7/library/audioop.html">audioop</a> library to read WAV files into an input samples stream for the <code class="docutils literal notranslate"><span class="pre">echo</span></code> module, and then visualise the input and output waveforms using <a class="reference external" href="https://matplotlib.org/">matplotlib</a>:</p>
<img alt="_images/echo_plot.png" src="_images/echo_plot.png" />
<p>Speedup the simulation by configuring <strong>PyGears</strong> simulator to use open-source <a class="reference external" href="http://www.veripool.org/wiki/verilator">Verilator</a> to simulate hardware modules, or some of the proprietary simulators like Questa, NCSim or Xsim. Implement any part of the system in a standard HDL and debug your design by inspecting the waveforms for an example in open-source wave viewer <a class="reference external" href="http://gtkwave.sourceforge.net">GTKWave</a></p>
<img alt="_images/echo_vcd.png" src="_images/echo_vcd.png" />
<p>Checkout <a class="reference internal" href="echo.html#echo-examples"><span class="std std-ref">Echo example description</span></a> for more in depth information about the <code class="docutils literal notranslate"><span class="pre">echo</span></code> example.</p>
<section id="installation-instructions">
<h3>Installation instructions<a class="headerlink" href="#installation-instructions" title="Permalink to this headline">¶</a></h3>
<p>Install <strong>PyGears</strong> package with the Python package manager. On Linux distributions, depending on how your Python was installed you might get an error and need to prefix the command with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install pygears
</pre></div>
</div>
<p>For more detailed installation instructions (including how to install additional software) checkout <a class="reference internal" href="install.html#install"><span class="std std-ref">Installation</span></a> page.</p>
</section>
<section id="read-the-documentation">
<h3>Read the documentation<a class="headerlink" href="#read-the-documentation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://docs.pygears.org/">PyGears documentation</a></p>
</section>
<section id="checkout-the-examples">
<h3>Checkout the examples<a class="headerlink" href="#checkout-the-examples" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="gears/index.html#common"><span class="std std-ref">Library of standard modules</span></a></p>
<p><a class="reference internal" href="echo.html#echo-examples"><span class="std std-ref">Echo</span></a>: Hardware module that applies echo audio effect to a continuous audio stream.</p>
<p><a class="reference external" href="https://github.com/bogdanvuk/pygears/tree/master/tests">Tests</a>: Contain many examples on how individual <strong>PyGears</strong> components operate</p>
</section>
</section>
<section id="contributions">
<h2>Contributions<a class="headerlink" href="#contributions" title="Permalink to this headline">¶</a></h2>
<p>Special thanks to the people that helped develop this framework:</p>
<ul class="simple">
<li><p>Andrea Erdeljan</p></li>
<li><p>Damjan Rakanović</p></li>
<li><p>Nemanja Kajtez</p></li>
<li><p>Risto Pejašinović</p></li>
<li><p>Stefan Tambur</p></li>
<li><p>Vladimir Nikić</p></li>
<li><p>Vladimir Vrbaški</p></li>
<li><p>Stefan Stanić</p></li>
<li><p>Filip Dojčinović</p></li>
<li><p>Aleksa Knežević</p></li>
<li><p>Alena Delkić</p></li>
<li><p>Nataša Samac</p></li>
<li><p>Jovan Stojanović</p></li>
<li><p>Mirko Jeličić</p></li>
<li><p>Stefan Sredojević</p></li>
<li><p>Dejan Marković</p></li>
<li><p>Tim Ling</p></li>
</ul>
<p>In order to contribute, pull your copy from <a class="reference external" href="https://github.com/bogdanvuk/pygears">github repository</a> and create a pull request.</p>
</section>
<section id="community">
<h2>Community<a class="headerlink" href="#community" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="https://discord.gg/N499SsBMVD"><img alt="_images/discord_join_us.png" class="align-center" src="_images/discord_join_us.png" style="width: 30%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference external image-reference" href="https://www.reddit.com/r/pygears/"><img alt="_images/reddit_join_us.png" class="align-center" src="_images/reddit_join_us.png" style="width: 30%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference external image-reference" href="https://pygears.quora.com/?invite_code=d35I9R5DWpN2bDMeX9mJ"><img alt="_images/quora_join_us.png" class="align-center" src="_images/quora_join_us.png" style="width: 30%;" /></a>
</section>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="presentation_pygears.html">Presentation for beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#linux">Linux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Quick introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#pipe-operator">Pipe operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#variable-number-of-arguments">Variable number of arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#gear-parameters">Gear parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#type-casting">Type casting</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#systemverilog-generation">SystemVerilog generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gears.html">Introduction to Gears</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gears.html#one-interface">One interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="gears.html#powerful-type-system">Powerful type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="gears.html#gear-composition">Gear composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="gears.html#functors">Functors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="typing.html">Typing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="typing.html#compile-time-type-checking">Compile time type checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html#polymorphic-modules-and-pattern-matching">Polymorphic modules and pattern matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="typing.html#types-reference">Types reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="echo.html">Echo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference.html#core">Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#infrastructure">Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#typing">Typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#gears">Gears</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="third_party_tools.html">Third party Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="third_party_tools.html#anari-sim-viewer-made-by-anari-ai">Anari Sim Viewer - Made by Anari AI</a></li>
</ul>
</li>
</ul>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="#">
    <img class="logo" src="_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">HW Design: A Functional Approach</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=bogdanvuk&repo=pygears&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<hr />
<hr />
<h3><a href="https://docs.pygears.org/blog/blog/category/release.html">Release notes</a></h3>
<hr />
<h3><a href="#">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="presentation_pygears.html">Presentation for beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Quick introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="gears.html">Introduction to Gears</a></li>
<li class="toctree-l1"><a class="reference internal" href="typing.html">Typing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="third_party_tools.html">Third party Tools</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Bogdan Vukobratovic.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>